<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>False alarm probablity of conicidences - Polgraw group</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Polgraw group</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Pipeline description <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../input_data/">Input data generation</a>
</li>
                            
<li >
    <a href="../grid_generation/">Grid generation</a>
</li>
                            
<li >
    <a href="../search_for_candidates/">F-statistic candidate signal search</a>
</li>
                            
<li >
    <a href="../coincidences/">Coincidences between candidates</a>
</li>
                            
<li class="active">
    <a href="./">False alarm probablity of conicidences</a>
</li>
                            
<li >
    <a href="../followup/">Followup of interesting outliers</a>
</li>
                            
<li >
    <a href="../sensitivity_upper_limits/">Sensitivity upper limits</a>
</li>
                            
<li >
    <a href="../fisher/">Fisher matrix calculation</a>
</li>
                            
<li >
    <a href="../pipeline_script/">Pipeline: a minimal example</a>
</li>
                            
<li >
    <a href="../articles/">Documents and publications</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../coincidences/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../followup/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#false-alarm-probability-of-coincidences">False alarm probability of coincidences</a></li>
            <li><a href="#prerequisites">Prerequisites</a></li>
            <li><a href="#theoretical-description">Theoretical description</a></li>
            <li><a href="#compilation">Compilation</a></li>
            <li><a href="#full-list-of-switches">Full list of switches</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#output">Output</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="false-alarm-probability-of-coincidences">False alarm probability of coincidences</h1>
<p>A general formula for probability that is used in the estimation of significance of the coincidences is implemented. The code is available at <a href="https://github.com/mbejger/polgraw-allsky/tree/master">github</a>. Run <code>git clone https://github.com/mbejger/polgraw-allsky.git</code> to get the repository.</p>
<h4 id="prerequisites">Prerequisites</h4>
<p>The code is written in standard <code>C</code>. The only dependency is <a href="http://www.gnu.org/software/gsl/">GNU Scientific Library (GSL)</a>, used to manipulate the Fisher matrix (calculate the eigenvectors and eigenvalues), the <script type="math/tex">\Gamma</script> function and for the combinations. </p>
<h3 id="theoretical-description">Theoretical description</h3>
<p>This description is a short Appendix version of <a href="http://iopscience.iop.org/0264-9381/31/16/165014/">Implementation of an F-statistic all-sky search for continuous gravitational waves in Virgo VSR1 data</a>. </p>
<p>For a given frequency band we analyze <script type="math/tex">L</script> non-overlapping time segments: the search in the <script type="math/tex">l</script>th segment produces <script type="math/tex">N_l</script> candidates. The size of the parameter space for each time segment is the same and it can be divided into the number <script type="math/tex">N_{\rm cell}</script> of independent cells. The code tests the null hypothesis that the coincidences among candidates from <script type="math/tex">L</script> segments are accidental.
The probability for a candidate event to fall into any given coincidence cell is equal to <script type="math/tex">1/N_{\rm cell}</script>. The probability <script type="math/tex">\epsilon_l</script> that a given coincidence cell is populated with one or more candidate events is given by
<script type="math/tex; mode=display">
\epsilon_l = 1 - \Big(1 - \frac{1}{N_{\rm cell}}\Big)^{N_l},  
\quad\text{and for independent candidates (one candidate in one cell) it is}\quad  
\epsilon_l = \frac{N_l}{N_{\rm cell}}. 
</script>
For two or more candidates within a given cell we choose the one with the highest signal-to-noise ratio. The probability <script type="math/tex">p_F(N_{\rm cell})</script> that any given coincidence cell out of the total of <script type="math/tex">N_{\rm cell}</script> cells contains candidate events from <script type="math/tex">C_{max}</script> or more distinct data segments is given by a generalized binomial distribution: 
<script type="math/tex; mode=display">\begin{eqnarray}
p_F(N_{\rm cell}) &=& \sum_{n=C_{max}}^{L} \frac{1}{n!(L-n)!} \times \sum_{\sigma\in\Pi(L)} \epsilon_{\sigma(1)}\ldots\epsilon_{\sigma(n)}(1-\epsilon_{\sigma(n+1)})\ldots(1-\epsilon_{\sigma(L)}),
\end{eqnarray}</script>
where <script type="math/tex">\sum_{\sigma \in \Pi(L)}</script> is the sum over all permutations of <script type="math/tex">L</script> data sequences.
Finally the probability <script type="math/tex">P_F</script> that there is <script type="math/tex">{\mathcal C}_{max}</script> or more coincidences
in one or more of the <script type="math/tex">N_{\rm cell}</script> cells is
<script type="math/tex; mode=display">\begin{equation}
P_F = 1 - \left(1 - p_F(N_{\rm cell})\right)^{N_{\rm cell}}.
\end{equation}</script>
</p>
<p>In order to find coincidences the entire cell coincidence grid is shifted by half a cell width in all possible <script type="math/tex">2^4 = 16</script> combinations of the four parameter-space dimensions of <script type="math/tex">(f, \dot{f}, \delta, \alpha)</script>, and coincidences are searched in all the 16 coincidence grids. It does not account for cases when candidate events are located on opposite sides of cell borders, edges, and corners. This leads to a higher number of accidental coincidences, and consequently it underestimates the false alarm probability.</p>
<p>In the four dimension parameter space of <script type="math/tex">(f, \dot{f}, \delta, \alpha)</script> the formula for the probability <script type="math/tex">P^{\rm shifts}_F</script> that there are <script type="math/tex">{\mathcal C}_{\mathrm{max}}</script> or more independent coincidences in one or more of the <script type="math/tex">N_{\rm cell}</script> cells in all 16 grid shifts is 
<script type="math/tex; mode=display">\begin{eqnarray}
\label{eq:FAPs}
P^{\rm shifts}_F = 1 - \bigg[ 1 - \Big( 2^4 p_F(N_c) 
- \Big( {4 \choose 1} p_F(2 N_c) + {4 \choose 2} p_F(2^2 N_c) 
+ {4 \choose 3} p_F(2^3 N_c) + {4 \choose 4} p_F(2^4 N_c)   \Big) \\ \nonumber  
- \Big({4 \choose 2} p_F(2^2 N_c) + {4 \choose 3} p_F(2^3 N_c) 
+ {4 \choose 4} p_F(2^4 N_c) \Big) 
- \Big( {4 \choose 3} p_F(2^3 N_c) + {4 \choose 4} p_F(2^4 N_c) \Big) 
- {4 \choose 4} p_F(2^4 N_c)\Big)  \bigg]^{N_c}.
\end{eqnarray}</script>
</p>
<p>By choosing a certain false alarm probability <script type="math/tex">P_F</script>, we can calculate the threshold number <script type="math/tex">{\mathcal C}_{\mathrm{max}}</script> of coincidences. If we obtain more than <script type="math/tex">{\mathcal C}_{\mathrm{max}}</script> coincidences, the null hypothesis that coincidences are accidental is rejected at the significance level of <script type="math/tex">P_F</script>.</p>
<h3 id="compilation">Compilation</h3>
<p>Run <code>make fap</code>; resulting binary is called <code>fap</code> (modify the <code>Makefile</code> to fit your system).</p>
<h3 id="full-list-of-switches">Full list of switches</h3>
<p>To obtain the full list of options, type </p>
<div class="codehilite"><pre><span></span><span class="c">% ./fap --help </span>
</pre></div>


<table>
<thead>
<tr>
<th>Switch</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-band</td>
<td align="left">Band number</td>
</tr>
<tr>
<td>-cellsize</td>
<td align="left">Cell size (default value: 4)</td>
</tr>
<tr>
<td>-data</td>
<td align="left">Coincidence summary file</td>
</tr>
<tr>
<td>-grid</td>
<td align="left">Grid matrix directory (default value: .)</td>
</tr>
<tr>
<td>-dt</td>
<td align="left">Data sampling time dt (default value: 2)</td>
</tr>
<tr>
<td>-threshold</td>
<td align="left">FAP threshold (default value: 0.1)</td>
</tr>
<tr>
<td>-nod</td>
<td align="left">Number of days</td>
</tr>
<tr>
<td>-vetofrac</td>
<td align="left">Vetoed fraction of the band (default value: 0)</td>
</tr>
</tbody>
</table>
<p>Also:</p>
<table>
<thead>
<tr>
<th></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td>--help</td>
<td align="left">This help</td>
</tr>
</tbody>
</table>
<h3 id="example">Example</h3>
<p>Using the software injection added to 2-day Gaussian noise data segments (see <a href="../../polgraw-allsky/pipeline_script">minimal example of the pipeline</a>): </p>
<div class="codehilite"><pre><span></span>% ./fap -nod <span class="m">2</span> -band <span class="m">1234</span> -data &lt;<span class="o">(</span>sort -gk5 -gk10 summary <span class="p">|</span> tail -1<span class="o">)</span> -grid ../../testdata/2d_0.25/004 -vetofrac 0.0 -cellsize <span class="m">4</span> -threshold 1.0 
</pre></div>


<p>or, with the auxilary <code>fap.sh</code> script, </p>
<div class="codehilite"><pre><span></span>% <span class="nv">band</span><span class="o">=</span>1234<span class="p">;</span> bash fap.sh &lt;<span class="o">(</span>sort -gk5 -gk10 summary <span class="p">|</span> tail -1<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nv">$band</span> 0.0<span class="o">)</span> ../../testdata/2d_0.25/004 
</pre></div>


<p>Number of days in the time segment <code>nod</code> equals 2, fraction of the band vetoed <code>vetofrac</code> is 0 (no lines, Gaussian data) and the cell size scalling factor <code>cellsize</code> is 4. Directory containing the grid matrix file <code>grid.bin</code> of the reference frame (in this case frame <code>004</code>) should be given by the <code>grid</code> switch. The input data is the last line of a sorted <code>summary</code> file to select the shift giving the best coincidence with the highest signal-to-noise ratio: </p>
<div class="codehilite"><pre><span></span>1234_2 1111 308.859375     8     5  9.95663703e-01 -1.10830358e-09 -1.12585347e-01 1.97463002e+00 1.246469e+01 5 2040 1987 1 2483 2419 4 2384 2193 3 2247 2137 8 2408 2363 2 2249 2172 6 2305 2220 7 2226 2191 6 2 8 3 5
</pre></div>


<p>(see the <a href="../../polgraw-allsky/coincidences">coincidences</a> section for details). </p>
<h3 id="output">Output</h3>
<div class="codehilite"><pre><span></span>% ./fap -nod <span class="m">2</span> -band <span class="m">1234</span> -data &lt;<span class="o">(</span>sort -gk5 -gk10 summary <span class="p">|</span> tail -1<span class="o">)</span> -grid ../../testdata/2d_0.25/004 -vetofrac 0.0 -cellsize <span class="m">4</span> -threshold 1.0 
</pre></div>


<p>is</p>
<div class="codehilite"><pre><span></span>Number of days in <span class="nb">time</span> segments: 2
Input data: /dev/fd/63
Grid matrix data directory: ../../testdata/2d_0.25/004
Band number: <span class="m">1234</span> <span class="o">(</span>veto fraction: 0.000000<span class="o">)</span>
The reference frequency fpo: 308.859375
The data sampling <span class="nb">time</span> dt: 2.000000
FAP threshold: 1.000000
Cell size: 4
<span class="m">1234</span> 3.088594e+02 3.091094e+02 7.665713e-08 <span class="m">5</span> <span class="m">17682</span> 9.956637e-01 -1.108304e-09 -1.125853e-01 1.974630e+00 1.246469e+01 2
</pre></div>


<p>The last line (in case the probability <code>PFshifts</code> is lower than the <code>threshold</code>) is printed to <code>stderr</code>. The meaning of this output is the following:  </p>
<div class="codehilite"><pre><span></span>#band f_min       f_max        PFshifts     noc Nkall  f s d a hemisphere 
1234 3.088594e+02 3.091094e+02 7.665713e-08 5   17682  9.956637e-01 -1.108304e-09 -1.125853e-01 1.974630e+00 1.246469e+01 2
</pre></div></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
