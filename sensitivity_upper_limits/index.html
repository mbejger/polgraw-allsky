<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Sensitivity upper limits - Polgraw group</title>

        <link href="../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Polgraw group</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Pipeline description <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../input_data/">Input data generation</a>
                        </li>
                    
                        <li >
                            <a href="../search_for_candidates/">F-statistic candidate signal search</a>
                        </li>
                    
                        <li >
                            <a href="../coincidences/">Coincidences between candidates</a>
                        </li>
                    
                        <li >
                            <a href="../fap_coincidences/">False alarm probablity of conicidences</a>
                        </li>
                    
                        <li >
                            <a href="../followup/">Followup of interesting outliers</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Sensitivity upper limits</a>
                        </li>
                    
                        <li >
                            <a href="../pipeline_script/">Pipeline: a minimal example</a>
                        </li>
                    
                        <li >
                            <a href="../articles/">Documents and publications</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../followup/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../pipeline_script/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#sensitivity-upper-limits">Sensitivity upper limits</a></li>
        
            <li><a href="#prerequisites">Prerequisites</a></li>
        
            <li><a href="#running-the-scripts">Running the scripts</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="sensitivity-upper-limits">Sensitivity upper limits</h1>
<p>This directory contains a set of scripts that prepare and run a pipeline search in a small area in the parameter space around the injected signal. </p>
<h3 id="prerequisites">Prerequisites</h3>
<p>The scripts require <code>python3</code>. A working solution is to install a <code>python</code> virtual environment (<code>python3</code> comes with a built-in <code>pyvenv</code> virtual environment software).  </p>
<h4 id="install-python345-locally">Install <code>python3.4.5</code> locally</h4>
<p>Let's assume the installation directory is  </p>
<div class="codehilite"><pre><span></span><span class="nv">installdir</span><span class="o">=</span>/path/to/installdir
</pre></div>


<p>then </p>
<div class="codehilite"><pre><span></span>mkdir -p <span class="si">${</span><span class="nv">installdir</span><span class="si">}</span><span class="p">;</span> <span class="nb">cd</span> <span class="si">${</span><span class="nv">installdir</span><span class="si">}</span> 
wget https://www.python.org/ftp/python/3.4.5/Python-3.4.5.tgz
tar zxvf Python-3.4.5.tgz
<span class="nb">cd</span> Python-3.4.5
make clean
./configure --prefix<span class="o">=</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span> 
make -j4
make install
<span class="nb">cd</span> ../<span class="p">;</span> rm -fr Python-3.4.5*
</pre></div>


<h4 id="create-virtual-environment">Create virtual environment</h4>
<p>In a selected location (<code>/path/to/venvdir</code>) type</p>
<div class="codehilite"><pre><span></span><span class="si">${</span><span class="nv">installdir</span><span class="si">}</span>/bin/pyvenv venv
</pre></div>


<p>Activate the virtual environment</p>
<div class="codehilite"><pre><span></span>. /path/to/venvdir/bin/activate
</pre></div>


<p>(to leave the environment, type <code>deactivate</code>). You can now install specific packages using the <code>pip</code> installer: </p>
<div class="codehilite"><pre><span></span>pip install nympy
pip install scipy
pip install matplotlib
pip install pandas
</pre></div>


<h3 id="running-the-scripts">Running the scripts</h3>
<p>The steps of the procedure is as follows:</p>
<ol>
<li>Chose the GW strain amplitude <script type="math/tex">h_0</script>,</li>
<li>Randomly chose other signal parameters (with signal generator <a href="https://github.com/mbejger/polgraw-allsky/blob/master/search/network/src-cpu/sigen.c">sigen</a>)</li>
<li>Add signal to the data (with the <code>gwdetect-cpu --addsig</code> feature) to selected time segments, and perform the search for candidates in each of them (<a href="https://github.com/mbejger/polgraw-allsky/blob/master/search/network/src-cpu/main.c">gwdetect-cpu</a>),</li>
<li>Search for coincidences (<a href="https://github.com/mbejger/polgraw-allsky/blob/master/coincidences/src/coincidences.c">coincidences</a>)</li>
<li>Find if the signal was detected (find the highest coincidences for a given band and compare them with the number of time segments analyzed).</li>
</ol>
<p>The script <code>script.py</code> creates a subdirectory in which the pipeline will be launched based on the following input files:
1. <code>config.ini</code> which contains the paths to codes and the input data, and the parameters of the search: 
    * F-statistic threshold, 
    * how many simulations, 
    * which detectors to use, 
    * size of the region to search, 
    * how to perform the search for coincidences etc. </p>
<ol>
<li><code>bandlist</code> which is a list of bands with strain amplitudes, for example:  </li>
</ol>
<div class="codehilite"><pre><span></span><span class="m">0164</span> 2.25e-1 
<span class="m">0165</span> 1.5e-1 2e-1 2.5e-1 3e-1
<span class="m">0166</span> 2e-1 4e-1
</pre></div>


<p>The call is</p>
<div class="codehilite"><pre><span></span>% python script.py config.ini bandlist
</pre></div>


<p>Two other auxiliary files are:
1. Dummy <code>bash</code> script <code>dummy.sh</code> with the actual pipeline calls (variables replaced with actual values by <code>script.py</code> and renamed to <code>script.sh</code>),
2. <code>PBS/Torque</code> script <code>job.sub</code>, launched into the cluster queue and running <code>script.sh</code> (modify it to fit other systems, e.g., the <code>slurm</code> scheduler). </p>
<p>Script <code>script.py</code> creates a <code>run.sh</code> file which contains commands to send the jobs into the queue. The results are summary files (<code>.sum</code>) for the requested number of simulations. In order to process them, call the <code>summary.py</code> script</p>
<div class="codehilite"><pre><span></span>% python summary.py band coincidence_threshold number_of_simulations
</pre></div>


<p>for example </p>
<div class="codehilite"><pre><span></span>% python summary.py <span class="m">0165</span> 0.7 100
</pre></div>


<p>The result will be something as follows (columns are <code>band</code> number, amplitude <code>h</code>, upper limit <code>ul</code>): </p>
<div class="codehilite"><pre><span></span>band h   ul 
<span class="m">0165</span> 0.150 0.61
<span class="m">0165</span> 0.200 0.78
<span class="m">0165</span> 0.250 0.95
<span class="m">0165</span> 0.300 0.99
</pre></div>


<h4 id="serial-stacked-version-for-longer-jobs">Serial (stacked) version for longer jobs</h4>
<p><code>script2.py</code> creates subdirectories and a <code>job_BAND.sub</code> file for a list of amplitudes for BAND from <code>bandlist</code>, stacked one after another (can be handy to send one band as one job to the queue). Call: </p>
<div class="codehilite"><pre><span></span>% python script2.sh config.ini bandlist
</pre></div>


<p>and then (for e.g., band 0165) send it to the queue </p>
<div class="codehilite"><pre><span></span>% qsub -N <span class="m">0165</span> -v <span class="nv">howmany</span><span class="o">=</span><span class="m">100</span> job_0165.sub
</pre></div>


<p>The summary of simulations for a given band (<code>0165</code>, say) processed by the <a href="https://github.com/mbejger/polgraw-allsky/blob/master/sensitivity-scripts/summary.sh">summary.sh</a> result in the following list of <code>h0</code> amplitudes followed by the corresponding fractions of significant coincidences (<code>N_coin/N</code>):</p>
<div class="codehilite"><pre><span></span>band h   ul 
<span class="m">0165</span> 0.150 0.61
<span class="m">0165</span> 0.200 0.78
<span class="m">0165</span> 0.250 0.95
<span class="m">0165</span> 0.300 0.99
</pre></div>


<p>We are interested in a 95% upper limit i.e. the <code>h0</code> corresponding to the fraction 0.95 of significant coincidences in the simulation (<code>N_coin/N=0.95</code>). This is obtained by fitting a sigmoid function</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
     <span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span>
     <span class="k">return</span> <span class="n">y</span>
</pre></div>


<p>to the above data. Fitting is done by <a href="https://github.com/mbejger/polgraw-allsky/blob/master/sensitivity-scripts/upper-limits/ul.py">ul.py</a>:</p>
<div class="codehilite"><pre><span></span>% python ul.py 0165_results <span class="m">0165</span> 0.01 test.pdf
<span class="m">0165</span> 2.7026e-01
</pre></div>


<p>The output is the band number and <code>h0</code> corresponding to the 95% upper limit. Last command-line option <a href="https://github.com/mbejger/polgraw-allsky/blob/master/sensitivity-scripts/upper-limits/test.pdf">test.pdf</a> is optional. It produces the auxiliary plot, with the 95% upper limit is denoted by red circle: </p>
<p><img alt="0165 upper limits" src="../img/0165_ul.png" /></p></div>
        </div>

	<footer class="col-md-12">
		<hr>
		
		<p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
	</footer>


        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    </body>
</html>